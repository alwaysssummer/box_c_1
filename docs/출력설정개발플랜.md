# 📄 출력설정 개발 플랜

> **문서 버전**: v2.0  
> **작성일**: 2024-12-11  
> **상태**: ✅ Q&A 완료, 개발 착수

---

## 목차

1. [Q&A 최종 결정 사항](#1-qa-최종-결정-사항)
2. [분석된 문제 유형](#2-분석된-문제-유형)
3. [핵심 설계: 그리드 + 필드](#3-핵심-설계-그리드--필드)
4. [데이터 구조](#4-데이터-구조)
5. [개발 태스크](#5-개발-태스크)
6. [검증 체크리스트](#6-검증-체크리스트)

---

## 1. Q&A 최종 결정 사항

### 1.1 기본 전략

| 항목 | 결정 | 비고 |
|-----|------|------|
| 기존 데이터 | 테스트용 1-2개 존재 | PDF 샘플 4종 분석 완료 |
| 시스템 전환 | 항상 최신 레이아웃 적용 | 버전 관리 불필요 |
| 롤백 기능 | 불필요 | 충분한 테스트 후 적용 |

### 1.2 레이아웃

| 항목 | 결정 | 비고 |
|-----|------|------|
| 오버플로우 | 동적 텍스트 조절 | 글자/행간/자간 자동 조정, 최소 8pt |
| 페이지 분할 | 텍스트 크기 조절로 커버 | 대부분 예상 범위 내 |
| 2단 비율 | 5:5 (50:50) | 고정 |
| 선택지 배치 | 문제 유형별 설정 | vertical/horizontal 선택 |
| 선택지 스타일 | ①②③④⑤ | 동그라미 숫자 기본 |

### 1.3 보안 및 출력

| 항목 | 결정 | 비고 |
|-----|------|------|
| 정답 노출 방지 | 학생용 뷰에서 필드 비활성화 | 원천 차단 |
| 출력물 종류 | 필드 조합 방식 | 학생용, 학생용+정답, 교사용, 정답만 |
| 경고 표시 | 문제 생성 시에만 | UI 경고 최소화 |

### 1.4 성능 및 사용성

| 항목 | 결정 | 비고 |
|-----|------|------|
| 미리보기 속도 | 2-3초 | 200페이지는 빠른보기(10p) + 전체 선택 |
| 레이아웃 복사 | 즐겨찾기 + 최근 사용 | Step 3에서 선택 |
| 필드 순서 | 자유 변경 (드래그) | 블록 기본값 제공 |

### 1.5 핵심 구조

| 항목 | 결정 | 비고 |
|-----|------|------|
| 그리드 | 1열 / 2열 선택 | 단순화 |
| 병렬 모드 | 쌍으로 묶음 (영-한) | 한줄해석용 |
| 반복 모드 | 문장별 반복 | 문장분석용 |

---

## 2. 분석된 문제 유형

### 2.1 PDF 샘플 분석 결과 (4종)

| PDF | 카테고리 | 유형 수 |
|-----|---------|--------|
| 문제 출력 샘플.pdf | 학습형 | 9종 |
| 실전형 문제 출력.pdf | 실전형 | 11종 |
| 문장분석샘플.pdf | 문장분석 | 6종 |
| 서술형.pdf | 서술형/영작 | 5종 |
| **합계** | | **31종+** |

### 2.2 유형 상세

#### 학습형 (9종)
- 단어장: 영+한, 영만, 한만
- 빈칸채우기: 해석O, 해석X
- 정답해설
- 어법선택: 2지, 3지
- 틀린곳찾기

#### 실전형 (11종)
- 내용 이해: 제목/주제/요지/일치/불일치
- 빈칸 추론: 단일/연결어/요약
- 어법/어휘: 밑줄/선택/부적절

#### 문장분석 (6종)
- 기본: 영어만, 지문전체
- 해석: 1단, 2단 병렬
- 심화: 구조분석, 어휘정리

#### 서술형/영작 (5종)
- 문장 중요도 분석 (S/A/B 등급)
- 어구 배열
- 조건 영작
- 부분 영작
- 서술형 해설

### 2.3 모든 유형의 공통 구조

**핵심 발견**: 31종+ 유형 모두 **그리드(열) + 필드(순서)** 조합으로 표현 가능

---

## 3. 핵심 설계: 그리드 + 필드

### 3.1 설계 원칙

```
출력 설정 = 열 개수 + 필드 순서 + span(너비)
```

**5가지 속성**만으로 모든 유형 표현:

| 속성 | 설명 | 값 |
|-----|------|-----|
| columns | 열 개수 | 1 또는 2 |
| fields[] | 필드 목록 | 순서대로 배치 |
| span | 열 차지 | 1 (기본) 또는 2 (전체) |
| parallel | 쌍 묶음 | true/false |
| repeat | 반복 여부 | true/false |

### 3.2 레이아웃 예시

#### 1열 배치
```
fields: [passage, question, choices]

┌──────────────┐
│    passage   │
├──────────────┤
│   question   │
├──────────────┤
│   choices    │
└──────────────┘
```

#### 2열 배치 (자유흐름)
```
columns: 2
fields: [passage, question, choices, answer]

┌───────┬───────┐
│passage│question│
├───────┼───────┤
│choices│ answer │
└───────┴───────┘
```

#### 2열 배치 (병렬 쌍)
```
columns: 2
parallel: true
fields: [english, korean]

┌───────┬───────┐
│영어1  │ 한글1 │
├───────┼───────┤
│영어2  │ 한글2 │
└───────┴───────┘
```

#### span 활용 (문장 상단 전체)
```
columns: 2
fields: [
  { key: 'sentence', span: 2 },
  { key: 'analysis' },
  { key: 'vocabulary' }
]

┌──────────────────┐
│     sentence     │  ← span: 2
├────────┬─────────┤
│analysis│vocabulary│ ← span: 1
└────────┴─────────┘
```

### 3.3 유형별 설정 예시

| 유형 | columns | 특수 설정 |
|-----|---------|----------|
| 단어장 | 2 | parallel: true |
| 빈칸채우기 | 1 | - |
| 한줄해석 2단 | 2 | parallel: true, repeat: true |
| 구조분석 | 2 | sentence span: 2 |
| 조건영작 | 2 | korean span: 2 |

---

## 4. 데이터 구조

### 4.1 OutputConfig (단순화)

```typescript
// src/types/output-config.ts

/**
 * 출력 설정 - 단순화된 구조
 */
export interface OutputConfig {
  version: '2.0'
  
  // 1. 그리드 설정
  columns: 1 | 2
  columnRatio?: [number, number]  // 2열일 때 비율 (기본 50:50)
  
  // 2. 필드 배치
  fields: FieldPlacement[]
  
  // 3. 병렬/반복 모드
  parallel?: boolean   // 쌍으로 묶음 (한줄해석용)
  repeat?: boolean     // 문장별 반복 (문장분석용)
  
  // 4. 용지 설정
  paper: {
    size: 'A4' | 'B5'
    orientation: 'portrait' | 'landscape'
    margins: { top: number; bottom: number; left: number; right: number }
  }
  
  // 5. 타이포그래피
  typography: {
    baseFontSize: number  // pt (기본 11)
    lineHeight: number    // 배수 (기본 1.5)
    minFontSize: number   // 최소 크기 (기본 8)
  }
  
  // 6. 옵션
  options: {
    pageNumbers: boolean
    choiceMarker: 'circled' | 'numbered' | 'parenthesis'  // ①②③ | 1.2.3. | (1)(2)(3)
    choiceLayout: 'vertical' | 'horizontal'
  }
}

/**
 * 필드 배치
 */
export interface FieldPlacement {
  key: string           // 필드 키 (passage, question 등)
  span?: 1 | 2          // 열 차지 (기본 1)
  showIn?: ViewType[]   // 표시할 뷰 타입
  style?: FieldStyle    // 스타일 오버라이드
}

/**
 * 뷰 타입 (필드 조합 방식)
 */
export type ViewType = 'student' | 'student_answer' | 'teacher' | 'answer_only'

/**
 * 필드 스타일
 */
export interface FieldStyle {
  fontSize?: number
  fontWeight?: 'normal' | 'bold'
  textAlign?: 'left' | 'center' | 'right'
}
```

### 4.2 기본값

```typescript
export const DEFAULT_OUTPUT_CONFIG: OutputConfig = {
  version: '2.0',
  columns: 1,
  fields: [
    { key: 'passage' },
    { key: 'question' },
    { key: 'choices' },
    { key: 'answer', showIn: ['student_answer', 'teacher', 'answer_only'] },
    { key: 'explanation', showIn: ['teacher'] }
  ],
  paper: {
    size: 'A4',
    orientation: 'portrait',
    margins: { top: 15, bottom: 15, left: 15, right: 15 }
  },
  typography: {
    baseFontSize: 11,
    lineHeight: 1.5,
    minFontSize: 8
  },
  options: {
    pageNumbers: true,
    choiceMarker: 'circled',
    choiceLayout: 'vertical'
  }
}
```

### 4.3 레이아웃 즐겨찾기

```typescript
/**
 * 레이아웃 즐겨찾기 (DB 저장)
 */
export interface LayoutFavorite {
  id: string
  name: string
  config: OutputConfig
  created_at: string
  updated_at: string
}
```

---

## 5. 개발 태스크

### Phase 1: 기반 구축 (1일)

| ID | 태스크 | 우선순위 | 예상 시간 |
|----|--------|----------|----------|
| T1-1 | OutputConfig 타입 정의 | 🔴 필수 | 1h |
| T1-2 | 기본값 정의 | 🔴 필수 | 30m |
| T1-3 | DB 스키마 변경 (output_config 컬럼) | 🔴 필수 | 1h |
| T1-4 | 블록 output_fields에 default_order 추가 | 🟡 중요 | 1h |

### Phase 2: UI 컴포넌트 (2일)

| ID | 태스크 | 우선순위 | 예상 시간 |
|----|--------|----------|----------|
| T2-1 | Step 3 출력 설정 위자드 스텝 | 🔴 필수 | 2h |
| T2-2 | 열 개수 선택 UI (1열/2열) | 🔴 필수 | 1h |
| T2-3 | 필드 순서 드래그앤드롭 | 🔴 필수 | 3h |
| T2-4 | span 설정 UI (전체너비 체크박스) | 🔴 필수 | 1h |
| T2-5 | 뷰 타입별 필드 표시 설정 | 🟡 중요 | 2h |
| T2-6 | 레이아웃 즐겨찾기/최근 사용 | 🟡 중요 | 2h |

### Phase 3: 렌더러 (2일)

| ID | 태스크 | 우선순위 | 예상 시간 |
|----|--------|----------|----------|
| T3-1 | 그리드 컨테이너 (1열/2열) | 🔴 필수 | 2h |
| T3-2 | 필드 렌더러 (text, array) | 🔴 필수 | 3h |
| T3-3 | span 처리 (전체 너비) | 🔴 필수 | 1h |
| T3-4 | parallel 모드 (쌍 렌더링) | 🟡 중요 | 2h |
| T3-5 | 선택지 마커 렌더러 | 🟡 중요 | 1h |
| T3-6 | 미리보기 컨테이너 | 🔴 필수 | 2h |

### Phase 4: 통합 (1일)

| ID | 태스크 | 우선순위 | 예상 시간 |
|----|--------|----------|----------|
| T4-1 | 문제 유형 저장 시 output_config 포함 | 🔴 필수 | 1h |
| T4-2 | 뷰 타입별 렌더링 분기 | 🔴 필수 | 2h |
| T4-3 | 기능 테스트 | 🔴 필수 | 2h |

**총 예상 시간: 약 6일**

---

## 6. 검증 체크리스트

### 6.1 Phase별 완료 조건

**Phase 1 완료**
- [ ] OutputConfig 타입 정의 완료
- [ ] DB 스키마 변경 적용
- [ ] 기본값 동작 확인

**Phase 2 완료**
- [ ] Step 3 UI 동작
- [ ] 필드 순서 드래그앤드롭 동작
- [ ] 열 개수 변경 시 미리보기 반영

**Phase 3 완료**
- [ ] 1열/2열 그리드 렌더링
- [ ] span 전체너비 동작
- [ ] 미리보기 실시간 반영

**Phase 4 완료**
- [ ] 저장/불러오기 동작
- [ ] 뷰 타입별 출력 정확

### 6.2 유형별 테스트

| 유형 | 설정 | 테스트 항목 |
|-----|------|-----------|
| 단어장 | 2열, parallel | 영-한 쌍 정렬 |
| 빈칸채우기 | 1열 | 순서대로 배치 |
| 한줄해석 2단 | 2열, parallel, repeat | 문장별 영-한 쌍 |
| 구조분석 | 2열, sentence span:2 | 상단 전체, 하단 분할 |
| 수능형 | 2열 | 좌:지문, 우:문제 |

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2024-12-11 | v1.0 | 초안 작성 |
| 2024-12-11 | v2.0 | Q&A 결과 반영, 구조 단순화 |

---

## 다음 단계

1. ✅ Q&A 완료
2. ✅ 개발 플랜 업데이트
3. **🚀 Phase 1 개발 시작**
