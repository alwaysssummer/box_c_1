# 📋 문제출제 서비스 - 개발 플랜

## 🎯 프로젝트 개요

| 항목 | 내용 |
|------|------|
| **서비스명** | 문제출제 관리 시스템 |
| **기술 스택** | Next.js 16 (App Router) + Supabase + Vercel |
| **UI** | shadcn/ui (GitHub 스타일) |
| **MVP 범위** | 교재관리, 프롬프트, 데이터 유형, 출력 유형, 데이터/문제 생성 |

---

## 📅 개발 단계 (Phase)

```
Phase 0: 프로젝트 초기 설정 ─────────────────── 1일  ✅ 완료
Phase 1: 데이터베이스 설계 및 구축 ────────────── 1일  ✅ 완료
Phase 2: 교재관리 기능 ───────────────────────── 3일  ✅ 완료
Phase 2.5: 문장분리 기능 ─────────────────────── 2일  ✅ 완료
Phase 3: 프롬프트 관리 ──────────────────────── 2일  ✅ 완료
Phase 4: 데이터 유형 관리 ─────────────────────── 2일  ✅ 완료
Phase 5: 출력 유형 관리 (확장) ─────────────────── 3일  ✅ 완료
Phase 6: 데이터/학습자료 생성 ──────────────────── 3일  ✅ 완료
Phase 7: 문제 생성 기능 (원큐 시스템) ────────────── 3일  ✅ 완료
Phase 8: 출력물 생성 (PDF) ───────────────────── 2일  ✅ 완료
Phase 9: 테스트 및 배포 ──────────────────────── 1일  ✅ MVP 1.0 완료
Phase 10-12: 출제 2단계 시스템 ──────────────────── 7일  ✅ 완료 (프롬프트 직접/슬롯 기반)
Phase 13: UI 통합 ────────────────────────────── 1일  ✅ 완료
Phase 14: 문제 미리보기 시스템 ─────────────────── 1일  ✅ 완료
                                    ─────────────
                                    총 약 30일
```

---

# 📊 출력 유형 종합 정리 (25종)

## 🎯 대분류: 학습자료 vs 문제

| 구분 | 정답 | 해설 | 목적 | 유형 수 |
|:----:|:----:|:----:|------|:------:|
| **학습자료** | ❌ | ❌ | 학습/이해 지원 | 4종 |
| **문제** | ✅ | ⚪/✅ | 평가/연습 | 21종 |

---

## 📚 학습자료 유형 (4종)

| # | 유형명 | 대상 | 설명 |
|---|--------|:----:|------|
| L1 | **영한 대조** | sentence | 좌: 영어 / 우: 한국어 |
| L2 | **끊어읽기 학습자료** | sentence | 구문분석 + 번역 + 단어 |
| L3 | **구조 분석 학습자료** | sentence | 구조(A) + 내용(B) + 논리(C) 분석 |
| L4 | **종합 분석 7단계** | passage | 배경~실전문제까지 7단계 분석 |

---

## 📝 문제 유형 - 원본 유지형 (6종)

> 지문을 변형하지 않고 그대로 사용

| # | 유형명 | 대상 | 선택지 | 해설 |
|---|--------|:----:|:------:|:----:|
| P1 | **제목 추론** | passage | 5지선다 | ✅ |
| P2 | **주제 추론** | passage | 5지선다 | ✅ |
| P3 | **요지 추론** | passage | 5지선다 | ✅ |
| P4 | **내용 일치/불일치** | passage | 5지선다 | ✅ |
| P5 | **심경/분위기** | passage | 5지선다 | ✅ |
| P6 | **목적 추론** | passage | 5지선다 | ✅ |

---

## 🔀 문제 유형 - 지문 변형형 (12종)

> 지문을 수정/재구성하여 출제

### 순서/삽입 유형

| # | 유형명 | 변형 방식 | 선택지 | 해설 |
|---|--------|----------|:------:|:----:|
| T1 | **글의 순서** | 문단 분리 + 셔플 | 순서 조합 | ✅ |
| T2 | **문장 삽입** | 문장 추출 + ①②③④⑤ 위치 | 위치 선택 | ✅ |

### 빈칸 유형

| # | 유형명 | 변형 방식 | 선택지 | 해설 |
|---|--------|----------|:------:|:----:|
| T3 | **빈칸 추론 (핵심어)** | 핵심 어휘/구 삭제 | 5지선다 | ✅ |
| T4 | **연결어 빈칸 (A)-(B)** | 연결어 삭제 | 조합 선택 | ⚪ |
| T5 | **빈칸 채우기 (다중)** | 여러 단어 삭제 | 각 빈칸 정답 | ❌ |

### 어법/어휘 유형

| # | 유형명 | 변형 방식 | 선택지 | 해설 |
|---|--------|----------|:------:|:----:|
| T6 | **양자 택일 어법** | [A/B] 선택지 삽입 | 각각 O/X | ✅ |
| T7 | **어법 틀린 것 1개** | ①~⑤ 밑줄 표시 | 번호 1개 | ✅ |
| T8 | **어법 어색 개수** | (A)~(E) 밑줄 표시 | 개수 1~5 | ✅ |
| T9 | **어휘 선택 조합** | (A)(B)(C) 선택지 삽입 | 조합 선택 | ⚪ |
| T10 | **어법 오류 수정** | 오류 N개 삽입 | 틀린것+수정 | ✅ |

### 서술형 유형

| # | 유형명 | 변형 방식 | 정답 형태 | 해설 |
|---|--------|----------|----------|:----:|
| T11 | **서술형 복합 (2문제)** | (A)(B) 출제 포인트 지정 | 서술형 | ✅ |
| T12 | **조건 영작** | 조건 제시 | 영작문 | ⚪ |

---

## ✍️ 문제 유형 - 문장 단위 (3종)

| # | 유형명 | 대상 | 정답 형태 | 해설 |
|---|--------|:----:|----------|:----:|
| S1 | **어구 배열** | sentence | 순서 번호 | ⚪ |
| S2 | **조건 영작 (문장별)** | sentence | 영작문 | ⚪ |
| S3 | **빈칸 채우기 (문장별)** | sentence | 단어/구 | ❌ |

---

## 📦 복합 문제 세트

| 유형 | 설명 | 최대 문제 수 |
|------|------|:-----------:|
| **복합 세트 (원본)** | 1지문 → 제목/주제/요지/내용일치 | 4문제 |
| **복합 세트 (변형)** | 1지문 → 순서/삽입/빈칸 조합 | 4문제 |

---

# 🚀 원큐 시스템 고도화 플랜

## 📌 개요

원큐 시스템은 **프롬프트가 완성된 문제를 직접 생성**하는 방식입니다.
슬롯 시스템과 **완전히 독립적**으로 운영되며, 대부분의 문제 유형에 적합합니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                     원큐 시스템 vs 슬롯 시스템                    │
├───────────────────────────┬─────────────────────────────────────┤
│     🚀 원큐 (우선 구현)    │     🧩 슬롯 (나중에 필요시)          │
├───────────────────────────┼─────────────────────────────────────┤
│ • 프롬프트 → AI → 완성문제 │ • 데이터유형 조합 → 문제            │
│ • 설정 간단 (3~4개 필드)  │ • 설정 복잡 (10개+ 필드)            │
│ • P1~P6, T1~T9, L1~L4    │ • 복합 커스텀 유형                   │
│ • prompt_id 연결          │ • dataTypes[] 매핑                  │
└───────────────────────────┴─────────────────────────────────────┘
```

---

## 📅 구현 단계

### Phase 15: 원큐 UI 단순화 ─────────────────── 1일 ✅ 완료

| 작업 | 상태 | 설명 |
|------|:----:|------|
| 입구 분리 (원큐/슬롯) | ✅ | QuestionTypeModeSelector 구현 |
| 프롬프트 원큐 폼 | ✅ | PromptBasedForm 구현 (3개 필드) |
| 프롬프트 상태 라벨 제거 | ✅ | 초안/확정 상태 제거, 단순화 |
| 기존 슬롯 폼 분리 | ✅ | QuestionTypeFormNew 유지 |

### Phase 16: 그룹별 레이아웃 시스템 ───────────── 2일 ✅ 완료

| 작업 | 상태 | 설명 |
|------|:----:|------|
| 레이아웃 서브타입 정의 | ✅ | LayoutSubtype, GROUP_LAYOUTS |
| practical 레이아웃 | ✅ | standard, with_box, blank |
| selection 레이아웃 | ✅ | binary, underline |
| analysis 레이아웃 | ✅ | vertical, two_column |
| writing/vocabulary | ✅ | arrange, partial, word_list 등 |

### Phase 17: 파싱-렌더링 일관성 ────────────── 2일 ✅ 완료

| 작업 | 상태 | 설명 |
|------|:----:|------|
| 출력포맷 템플릿 검증 | ✅ | OUTPUT_FORMAT_TEMPLATES 점검 |
| 그룹별 파싱 함수 | ✅ | parseByGroup, validateParsedResult |
| QuestionRenderer 확장 | ✅ | 2열형, 박스형 렌더링 지원 |
| 타입 re-export | ✅ | types/index.ts 업데이트 |

### Phase 18: 프롬프트 라이브러리 구축 ──────── 3일 ✅ 완료

| 작업 | 상태 | 설명 |
|------|:----:|------|
| P1~P6 (원본유지형) | ✅ | 제목/주제/요지/내용일치/심경/목적 |
| T1~T3 (순서/삽입/빈칸) | ✅ | 변형형 실전 문제 |
| T6~T9 (어법/어휘) | ✅ | 선택/수정형 문제 |
| L1~L4 (학습자료) | ✅ | 영한대조/끊어읽기/구조분석/종합분석 |
| S1, T12 (서술형) | ✅ | 어구배열, 조건영작 |
| 시드 스크립트 | ✅ | scripts/seed-prompts.ts (18종) |

### Phase 19: 강사 페이지 출력 완성 ─────────── 2일 ✅ 완료

| 작업 | 상태 | 설명 |
|------|:----:|------|
| A4 페이지네이션 고도화 | ✅ | 100% 정확한 페이지 분할 |
| 밀도 옵션 | ✅ | compact/normal/spacious |
| 인쇄 스타일 | ✅ | CSS @media print |
| PDF 생성 | ✅ | html2pdf.js 동적 임포트 |
| 출력 옵션 | ✅ | 문제만/정답포함/해설포함/정답만 |

---

## 📊 원큐 지원 문제 유형 (그룹별)

### 🔵 practical (실전형) - 5지선다

| ID | 유형명 | 레이아웃 | 원큐 지원 |
|----|--------|----------|:--------:|
| P1 | 제목 추론 | 표준형 | ✅ |
| P2 | 주제 추론 | 표준형 | ✅ |
| P3 | 요지 추론 | 표준형 | ✅ |
| P4 | 내용 일치/불일치 | 표준형 | ✅ |
| P5 | 심경/분위기 | 표준형 | ✅ |
| P6 | 목적 추론 | 표준형 | ✅ |
| T1 | 글의 순서 | 박스형 | ✅ |
| T2 | 문장 삽입 | 박스형 | ✅ |
| T3 | 빈칸 추론 | 빈칸형 | ✅ |

### 🟢 selection (선택/수정형)

| ID | 유형명 | 레이아웃 | 원큐 지원 |
|----|--------|----------|:--------:|
| T6 | 양자택일 어법 | 양자택일 | ✅ |
| T7 | 어법 틀린 것 | 밑줄형 | ✅ |
| T8 | 어법 어색 개수 | 밑줄형 | ✅ |
| T9 | 어휘 선택 조합 | 양자택일 | ✅ |

### 🟡 writing (서술형/영작)

| ID | 유형명 | 레이아웃 | 원큐 지원 |
|----|--------|----------|:--------:|
| S1 | 어구 배열 | 배열형 | ✅ |
| T11 | 서술형 복합 | 영작형 | ✅ |
| T12 | 조건 영작 | 영작형 | ✅ |

### 🟣 analysis (문장분석/학습자료)

| ID | 유형명 | 레이아웃 | 원큐 지원 |
|----|--------|----------|:--------:|
| L1 | 영한 대조 | 2열형 | ✅ |
| L2 | 끊어읽기 | 세로형 | ✅ |
| L3 | 구조 분석 | 세로형 | ✅ |
| L4 | 종합 분석 | 세로형 | ✅ |

---

## 🔧 핵심 구현 파일

| 파일 | 역할 |
|------|------|
| `src/lib/slot-system.ts` | 그룹/슬롯/출력포맷 정의 |
| `src/lib/prompt-parser.ts` | AI 응답 [[tag]] 파싱 |
| `src/app/api/generate-question/route.ts` | 원큐 생성 API |
| `src/components/features/question/QuestionRenderer.tsx` | 문제 렌더러 |
| `src/components/features/question-type/PromptBasedForm.tsx` | 원큐 설정 폼 |
| `src/app/teacher/page.tsx` | 강사 출력 페이지 |

---

## ⏰ 완료 현황

```
Phase 15: UI 단순화 ─────────────── 1일  ✅ 완료
Phase 16: 레이아웃 시스템 ─────────── 2일  ✅ 완료
Phase 17: 파싱-렌더링 일관성 ──────── 2일  ✅ 완료
Phase 18: 프롬프트 라이브러리 ─────── 3일  ✅ 완료
Phase 19: 출력 완성 ─────────────── 2일  ✅ 완료
                        ─────────────
                        🎉 원큐 시스템 고도화 완료!
```

---

# 🏗️ 확장 가능한 시스템 설계

## 계층 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                      Layer 1: 프롬프트                          │
│                   (AI 지시문 + 출력 스키마)                      │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    Layer 2: 데이터 유형                         │
│              (프롬프트 + 대상 + 카테고리 + 의존성)               │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    Layer 3: 출력 유형                           │
│        (학습자료 / 문제) + 데이터 조합 + 변형 설정               │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    Layer 4: 출력물                              │
│              (문제지 / 정답지 / 해설지 / 학습자료)               │
└─────────────────────────────────────────────────────────────────┘
```

## 데이터 유형 분류 체계

```
데이터 유형
├── 📦 기본 데이터 (Base)
│   ├── 문장 분리
│   ├── 문장 번역
│   └── 단어 추출
│
├── 📊 분석 데이터 (Analysis)
│   ├── 구문 분석
│   ├── 논리 분석
│   ├── 어법 포인트
│   └── 중심 내용 (제목/주제/요지)
│
├── 🔄 변형 데이터 (Transform)
│   ├── 문단 분리 (순서용)
│   ├── 문장 추출 (삽입용)
│   ├── 빈칸 처리
│   └── 선택지 삽입
│
└── 📝 문제 데이터 (Question)
    ├── 선택지 생성
    ├── 정답 생성
    └── 해설 생성
```

## 데이터 재사용 관계도

```
┌─────────────────────────────────────────────────────────────────┐
│                    기본 데이터 (재사용 가능)                     │
├─────────────────────────────────────────────────────────────────┤
│ • 문장 분리          → 모든 sentence level 유형                 │
│ • 문장 번역          → 영한대조, 어구배열, 빈칸채우기            │
│ • 구문 분석          → 끊어읽기, 어구배열                        │
│ • 어법 포인트        → 양자택일, 틀린것찾기, 개수, 오류수정      │
│ • 중심내용 (제목/주제/요지) → 원본유지 문제 전체                 │
│ • 문장별 논리 (역할) → 순서, 삽입 문제                          │
│ • 핵심 의미          → 빈칸 추론                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

# 📅 상세 개발 단계

## 🔧 Phase 0: 프로젝트 초기 설정 ✅ 완료

### Task 0.1: Next.js 프로젝트 생성 ✅
- [x] TypeScript 설정
- [x] Tailwind CSS 설정
- [x] ESLint 설정
- [x] App Router 구조 확인

### Task 0.2: shadcn/ui 설치 및 설정 ✅
- [x] 테마 설정 (GitHub 스타일 - neutral 기반)
- [x] 기본 컴포넌트 설치 (16개)

### Task 0.3: Supabase 연동 ✅
- [x] 환경 변수 설정 (env.example)
- [x] Supabase 클라이언트 설정 (lib/supabase/)

### Task 0.4: 프로젝트 구조 설정 ✅
```
src/
├── app/
│   ├── api/           ✅
│   ├── globals.css    ✅ GitHub 테마
│   ├── layout.tsx     ✅
│   └── page.tsx       ✅ 3단 레이아웃
├── components/
│   ├── ui/            ✅ shadcn 16개
│   ├── layout/        ✅ Sidebar, MainContent, RightPanel
│   └── features/      ✅ textbook, prompt, data-type, question-type, data-generate
├── contexts/          ✅ SheetImportContext, DataGenerateContext
├── lib/
│   ├── supabase/      ✅ client, server
│   ├── utils.ts       ✅
│   ├── prompt-utils.ts ✅ extractVariables
│   ├── api-utils.ts   ✅ handleApiError
│   └── tree-utils.ts  ✅ convertToTreeNodes
├── types/             ✅ database.ts, index.ts
└── hooks/             ✅ useGroups, useDataTypes, useQuestionTypes
```

---

## 🗄️ Phase 1: 데이터베이스 설계 및 구축 ✅ 완료

### Task 1.1: 교재 관련 테이블 ✅
- [x] groups 테이블
- [x] textbooks 테이블
- [x] units 테이블
- [x] passages 테이블
- [x] sentences 테이블

### Task 1.2: 프롬프트 테이블 ✅
- [x] prompts 테이블
- [x] prompt_test_history 테이블

### Task 1.3: 데이터 유형 테이블 ✅
- [x] data_types 테이블
- [x] data_type_dependencies 테이블

### Task 1.4: 출력 유형 테이블 ✅
- [x] question_types 테이블 (→ output_types로 확장 예정)
- [x] question_type_items 테이블

### Task 1.5: 생성 결과 테이블 ✅
- [x] generated_data 테이블
- [x] generated_questions 테이블
- [x] data_generation_stats 뷰

### Task 1.6: TypeScript 타입 정의 ✅
- [x] types/database.ts - 모든 테이블 타입 정의
- [x] types/index.ts - 공통 타입 정의

### Task 1.7: API Routes ✅
- [x] `app/api/groups/route.ts` - CRUD + reorder
- [x] `app/api/textbooks/route.ts` - CRUD + reorder
- [x] `app/api/units/route.ts` - CRUD + reorder
- [x] `app/api/passages/route.ts` - CRUD
- [x] `app/api/prompts/route.ts` - CRUD
- [x] `app/api/data-types/route.ts` - CRUD
- [x] `app/api/question-types/route.ts` - CRUD

---

## 📚 Phase 2: 교재관리 기능 ✅ 완료

### Task 2.1: 3단 레이아웃 구현 ✅
- [x] `components/layout/Sidebar.tsx` - 좌측 패널
- [x] `components/layout/MainContent.tsx` - 중앙 패널 (서브탭 지원)
- [x] `components/layout/RightPanel.tsx` - 우측 패널
- [x] 탭 네비게이션 (회원관리/교재관리/설정)

### Task 2.2: 그룹 관리 ✅
- [x] `components/features/textbook/GroupList.tsx`
- [x] 그룹 추가/삭제/순서변경

### Task 2.3: 트리 구조 컴포넌트 ✅
- [x] `components/features/textbook/TextbookTree.tsx`
- [x] 재귀적 트리 렌더링, 토글, 드래그앤드롭

### Task 2.4: 교재 등록 (구글시트 연동) ✅
- [x] `components/features/textbook/SheetImporter.tsx`
- [x] `components/features/textbook/SheetSelector.tsx`

### Task 2.5: 교재 상세/관리 ✅
- [x] `components/features/textbook/TextbookDetail.tsx`
- [x] `components/features/textbook/PassageDetail.tsx`

---

## ✂️ Phase 2.5: 문장분리 기능 ✅ 완료

- [x] `components/features/textbook/SplitDetailPanel.tsx`
- [x] `app/api/sentence-split/route.ts`
- [x] `contexts/SheetImportContext.tsx`

---

## 📝 Phase 3: 프롬프트 관리 ✅ 완료

- [x] `components/features/prompt/PromptList.tsx`
- [x] `components/features/prompt/PromptForm.tsx`
- [x] `app/api/test-prompt/route.ts`

---

## 📊 Phase 4: 데이터 유형 관리 ✅ 완료

- [x] `components/features/data-type/DataTypeList.tsx`
- [x] `components/features/data-type/DataTypeForm.tsx`
- [x] 프롬프트 연결, 의존성 설정

---

## 🎯 Phase 5: 출력 유형 관리 (확장) 🔄 진행중

### Task 5.1: DB 스키마 확장 ⏳
- [ ] data_types 테이블에 `category`, `config` 컬럼 추가
- [ ] question_types 테이블에 `purpose`, `passage_transform`, `output_config`, `extends_from` 컬럼 추가

```sql
-- data_types 확장
ALTER TABLE data_types 
  ADD COLUMN IF NOT EXISTS category TEXT 
    CHECK (category IN ('base', 'analysis', 'transform', 'question')) 
    DEFAULT 'analysis';
ALTER TABLE data_types 
  ADD COLUMN IF NOT EXISTS config JSONB DEFAULT '{}';

-- question_types 확장 (출력 유형으로 통합)
ALTER TABLE question_types 
  ADD COLUMN IF NOT EXISTS purpose TEXT 
    CHECK (purpose IN ('learning', 'assessment')) 
    DEFAULT 'assessment';
ALTER TABLE question_types 
  ADD COLUMN IF NOT EXISTS passage_transform JSONB DEFAULT '{}';
ALTER TABLE question_types 
  ADD COLUMN IF NOT EXISTS output_config JSONB DEFAULT '{}';
ALTER TABLE question_types 
  ADD COLUMN IF NOT EXISTS extends_from UUID 
    REFERENCES question_types(id);
```

### Task 5.2: TypeScript 타입 업데이트 ⏳
- [ ] DataType 타입에 category, config 추가
- [ ] QuestionType → OutputType 확장 타입 추가

### Task 5.3: 출력 유형 UI 확장 ⏳
- [ ] 목적 선택 (학습자료/문제)
- [ ] 지문 변형 설정 UI
- [ ] 출력 설정 UI (정답/해설 필요 여부)
- [ ] 템플릿 상속 UI

### Task 5.4: 기본 템플릿 등록 ⏳
- [ ] 학습자료 템플릿 4종
- [ ] 원본 유지 문제 템플릿 6종
- [ ] 지문 변형 문제 템플릿 12종
- [ ] 문장 단위 문제 템플릿 3종

---

## ⚡ Phase 6: 데이터/학습자료 생성 ⏳ 대기

### Task 6.1: 데이터 생성 UI 개선
- [ ] 생성된 데이터 상세 보기
- [ ] 재생성 기능
- [ ] 수동 편집 기능

### Task 6.2: 학습자료 생성
- [ ] 영한 대조 생성
- [ ] 끊어읽기 학습자료 생성
- [ ] 구조 분석 학습자료 생성
- [ ] 종합 분석 7단계 생성

---

## 🎯 Phase 7: 문제 생성 기능 ✅ 완료 → 🔄 출제2단계 시스템으로 통합

> ⚠️ **2024-12-06 변경**: 원큐 시스템이 출제2단계 시스템(`TwoStepGeneration`)으로 일원화됨
> - `OneClickGeneration.tsx` 삭제
> - 문제출제 탭 → TwoStepGeneration 직접 렌더링

### Task 7.1: ~~원큐 문제 생성 시스템~~ → 출제2단계 시스템으로 대체
- [x] ~~원큐 문제 생성 UI (`OneClickGeneration.tsx`)~~ → 삭제됨
- [x] 자동 사전 검증 → TwoStepGeneration 1단계로 이동
- [x] 미리보기 모드 → TwoStepGeneration 2단계로 이동
- [x] 선택적 저장 기능 → TwoStepGeneration으로 이동

### Task 7.2: 지문 단위 선택 ✅ → TwoStepGeneration 자체 UI
- [x] 교재/단원/지문 계층 체크박스 → TwoStepGeneration 내장
- [x] 상위 선택 시 하위 자동 선택
- [x] 부분 선택 상태 표시 (◐)
- [x] 선택된 지문 수 표시

### Task 7.3: 문제 관리 기능 ✅ (유지)
- [x] 문제관리 탭 분리
- [x] 필터 기능 (데이터유형/문제유형/상태)
- [x] 체크박스 기반 삭제
- [x] 전체 삭제 / 유형별 삭제
- [x] 계층적 종속 삭제 (지문 > 문제 > 데이터)

### Task 7.4: API 엔드포인트 ✅ (유지)
- [x] `/api/generate-questions` - 문제 생성
- [x] `/api/generate-questions/validate` - 사전 검증
- [x] `/api/passages/batch-delete-generated` - 일괄 삭제
- [x] `/api/passages/[id]/generated/by-question-type` - 유형별 삭제

---

## 📄 Phase 8: 출력물 생성 (PDF) ⏳ 대기

### Task 8.1: 출력물 유형별 템플릿
- [ ] 문제지 레이아웃
- [ ] 정답지 레이아웃
- [ ] 해설지 레이아웃
- [ ] 학습자료 레이아웃

### Task 8.2: PDF 생성 기능
- [ ] `app/api/export/pdf/route.ts`

### Task 8.3: 내보내기 UI
- [ ] `components/features/export/ExportDialog.tsx`

---

## 🚀 Phase 9: 테스트 및 배포 🔄 진행중

### Task 9.1: 테스트
- [x] 테스트 체크리스트 작성
- [ ] 주요 기능 수동 테스트

### Task 9.2: Vercel 배포 ✅
- [x] Vercel 프로젝트 연결
- [x] GitHub 연동 (자동 배포)
- [x] 환경 변수 설정

### Task 9.3: 문서화 ✅
- [x] README.md 작성
- [x] SETUP.md 작성
- [x] 개발 플랜.md 작성
- [x] 테스트 체크리스트.md 작성

---

## 📌 진행 현황

| Phase | 상태 | 완료일 |
|-------|------|--------|
| Phase 0: 초기 설정 | ✅ 완료 | - |
| Phase 1: DB 설계 | ✅ 완료 | - |
| Phase 2: 교재관리 | ✅ 완료 | - |
| Phase 2.5: 문장분리 | ✅ 완료 | - |
| Phase 3: 프롬프트 관리 | ✅ 완료 | - |
| Phase 4: 데이터 유형 | ✅ 완료 | - |
| Phase 5: 출력 유형 (확장) | 🔄 진행중 | - |
| Phase 6: 데이터/학습자료 생성 | ✅ 완료 | 2024-12-05 |
| Phase 7: 문제 생성 (원큐 시스템) | ✅ 완료 | 2024-12-05 |
| Phase 7.5: 문제 관리 | ✅ 완료 | 2024-12-05 |
| Phase 8: PDF 출력 | ⏳ 대기 | - |
| Phase 9: 테스트/배포 | 🔄 진행중 | - |
| Phase 10: 슬롯 시스템 기반 | 🔶 UI완료/DB미적용 | 2024-12-06 |
| Phase 11: 1단계 검증 시스템 | 🔶 UI완료/DB미적용 | 2024-12-06 |
| Phase 12: 2단계 생성/조합 | 🔶 UI완료/DB미적용 | 2024-12-06 |
| Phase 13: UI 통합 | ✅ 완료 | 2024-12-06 |

---

## 🔄 최근 업데이트

| 날짜 | 내용 |
|------|------|
| 2024-12-06 | **📋 출력 형식 자동 주입**: 그룹별 [[태그]] 템플릿 정의, AI 호출 시 자동 추가, UI 안내 표시 |
| 2024-12-06 | **🚀 프롬프트 → 문제 유형 자동 등록**: 프롬프트 저장 시 question_types 자동 생성, 🚀/🧩 아이콘 구분 |
| 2024-12-06 | **🔀 2가지 출제 경로 구현**: 프롬프트 직접 생성 / 슬롯 기반 조합 분기 처리 |
| 2024-12-06 | **⚡ 시스템 일원화**: 원큐 시스템 → 출제2단계 시스템으로 통합, OneClickGeneration 삭제 |
| 2024-12-06 | **출제2단계 수정**: 교재 트리 로드 문제 해결, 검증 API 간소화 |
| 2024-12-06 | **Phase 10-12 UI 완료**: 슬롯 시스템 UI, 검증 UI, 조합 UI 구현 |
| 2024-12-06 | **Phase 13 완료**: TwoStepGeneration 컴포넌트 구현 |
| 2024-12-06 | 출제 2단계 시스템 설계 확정, 슬롯 시스템 정의 |
| 2024-12-05 | 원큐 문제 생성 시스템 완성 (Phase 7 완료) → 2단계 시스템으로 대체됨 |
| 2024-12-05 | 문제관리 탭 분리, 필터/삭제 기능 (Phase 7.5 완료) |
| 2024-12-05 | 자동 사전 검증, 미리보기 모드, 선택적 저장 |
| 2024-12-05 | 지문 단위 선택 (교재/단원/지문 계층 체크박스) |
| 2024-12-05 | 출력 유형 25종 정리, 확장 가능한 시스템 설계, Phase 5 재정의 |
| 2024-12-04 | MVP 1.0 커밋, 리팩토링 완료 |

---

# 🚀 출제 2단계 시스템 (신규)

## 📋 시스템 개요

### 🔀 2가지 출제 경로

```
┌─────────────────────────────────────────────────────────────────┐
│                    출제 시스템 분기                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  문제 유형 선택                                                  │
│       │                                                         │
│       ├──▶ prompt_id 있음 → 🚀 프롬프트 직접 생성               │
│       │       └── 사전데이터 검증 없이 즉시 문제 생성             │
│       │                                                         │
│       └──▶ prompt_id 없음 → 🧩 슬롯 기반 조합                   │
│               └── 1단계: 사전데이터 검증                         │
│               └── 2단계: 슬롯 매핑 & 조합                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 📝 슬롯 기반 조합 흐름

```
┌─────────────────────────────────────────────────────────────────┐
│                    출제 2단계 시스템                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1단계: 사전데이터 검증                                          │
│  ├── 필요 데이터 확인                                            │
│  ├── 생성됨/미생성 상태 표시                                     │
│  └── 누락 데이터 생성 유도                                       │
│                                                                 │
│  2단계: 문제 생성/조합                                           │
│  ├── 검증된 데이터 → 템플릿 슬롯 매핑                            │
│  ├── 레이아웃 조합                                               │
│  └── 최종 출력 (미리보기/저장/PDF)                               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 🔗 데이터-슬롯 연결 시스템

### 통일 슬롯명 체계

```typescript
// 전체 시스템에서 사용할 표준 슬롯명
const STANDARD_SLOTS = {
  // 공통
  instruction: '지시문',
  body: '본문',
  choices: '선택지',
  answer: '정답',
  explanation: '해설',
  
  // 분석형
  original: '원문',
  translation: '해석',
  vocabulary: '어휘',
  grammar: '문법',
  
  // 서술형/영작
  hints: '힌트',
  blanks: '빈칸',
  arrangement: '배열정보',
  
  // 선택/수정형
  options: '양자택일',
  underlines: '밑줄',
  
  // 단어장
  word: '영단어',
  meaning: '뜻',
  example: '예문',
  definition: '영영풀이'
}
```

### 프롬프트 파싱 규칙

```
프롬프트 결과 형식:
[[슬롯명]]내용[[/슬롯명]]

예시:
[[original]]The concept of social capital...[[/original]]
[[translation]]사회적 자본의 개념은...[[/translation]]
[[vocabulary]]social: 사회적인, capital: 자본[[/vocabulary]]
```

### 데이터 흐름

```
프롬프트 실행 → 구분인자 파싱 → 슬롯명별 저장 → 템플릿 슬롯에 자동 매핑
```

---

## 🏗️ Phase 10: 출제 2단계 시스템 - 슬롯 기반 구축 🔶 UI완료/DB미적용

### Task 10.1: 표준 슬롯명 시스템 정의 ✅
- [x] `lib/slot-system.ts` 생성
- [x] `STANDARD_SLOTS` 상수 정의
- [x] 슬롯명 ↔ 한글명 매핑
- [x] 그룹별 사용 가능 슬롯 정의

```typescript
// lib/slot-system.ts
export const SLOT_GROUPS = {
  practical: ['instruction', 'body', 'givenBox', 'choices', 'answer', 'explanation'],
  selection: ['instruction', 'body', 'options', 'underlines', 'answer', 'explanation'],
  writing: ['original', 'translation', 'hints', 'blanks', 'arrangement', 'answer'],
  analysis: ['original', 'translation', 'vocabulary', 'grammar'],
  vocabulary: ['word', 'meaning', 'example', 'definition']
}
```

### Task 10.2: 프롬프트 파싱 시스템 ✅
- [x] `lib/prompt-parser.ts` 생성
- [x] 구분인자 `[[tag]]...[[/tag]]` 파싱 함수
- [x] 파싱 결과 → 슬롯명별 데이터 객체 변환
- [x] 파싱 오류 핸들링

```typescript
// lib/prompt-parser.ts
interface ParsedData {
  [slotName: string]: string | string[]
}

export function parsePromptResult(result: string): ParsedData {
  const regex = /\[\[(\w+)\]\]([\s\S]*?)\[\[\/\1\]\]/g
  const parsed: ParsedData = {}
  let match
  while ((match = regex.exec(result)) !== null) {
    parsed[match[1]] = match[2].trim()
  }
  return parsed
}
```

### Task 10.3: 데이터 유형 스키마 확장 ✅
- [x] `data_types` 테이블에 `output_slots` 컬럼 추가
- [ ] 데이터 유형별 출력 슬롯 정의 UI (Phase 11에서 구현)
- [ ] 프롬프트 ↔ 출력 슬롯 연결 검증 (Phase 11에서 구현)

```sql
-- 데이터 유형에 출력 슬롯 정의
ALTER TABLE data_types 
  ADD COLUMN IF NOT EXISTS output_slots TEXT[] DEFAULT '{}';

COMMENT ON COLUMN data_types.output_slots IS 
  '이 데이터 유형이 생성하는 슬롯명 목록 (예: original, translation, vocabulary)';
```

### Task 10.4: 문제 유형 템플릿 슬롯 시스템 ✅
- [x] `question_types` 테이블에 `required_slots` 컬럼 추가
- [x] `question_types` 테이블에 `question_group` 컬럼 추가
- [ ] 템플릿별 필요 슬롯 정의 UI (Phase 11에서 구현)
- [ ] 슬롯 ↔ 데이터 자동 매핑 로직 (Phase 12에서 구현)

```sql
-- 문제 유형에 필요 슬롯 정의
ALTER TABLE question_types 
  ADD COLUMN IF NOT EXISTS required_slots TEXT[] DEFAULT '{}';

COMMENT ON COLUMN question_types.required_slots IS 
  '이 문제 유형이 필요로 하는 슬롯명 목록';
```

### Task 10.5: generated_data 스키마 확장 ✅
- [x] `generated_data` 테이블에 `slot_data` 컬럼 추가
- [x] TypeScript 타입 정의 업데이트
- [ ] 지문별 슬롯 데이터 조회 API (Phase 11에서 구현)

```sql
-- generated_data에 슬롯 정보 추가
ALTER TABLE generated_data 
  ADD COLUMN IF NOT EXISTS slot_data JSONB DEFAULT '{}';

-- slot_data 예시: { "original": "...", "translation": "...", "vocabulary": [...] }
```

---

## 🏗️ Phase 11: 출제 1단계 - 사전데이터 검증 시스템 🔶 UI완료/DB미적용

### Task 11.1: 검증 로직 구현 ✅
- [x] `lib/data-validator.ts` 생성
- [x] 문제 유형 → 필요 슬롯 추출
- [x] 지문별 생성된 슬롯 확인
- [x] 누락 슬롯 목록 반환

```typescript
// lib/data-validator.ts
interface ValidationResult {
  passageId: string
  status: 'complete' | 'partial' | 'missing'
  existingSlots: string[]
  missingSlots: string[]
}

export async function validateDataForQuestionType(
  passageIds: string[], 
  questionTypeId: string
): Promise<ValidationResult[]>
```

### Task 11.2: 검증 UI 구현 ✅
- [x] `components/features/generation/DataValidation.tsx`
- [x] 지문별 검증 상태 표시 (✅/⚠️/❌)
- [x] 누락 데이터 목록 표시
- [x] "누락 데이터 생성" 버튼

```
┌──────────────────────────────────────────────────┐
│ 📋 사전데이터 검증 결과                           │
├──────────────────────────────────────────────────┤
│ 지문 1: ✅ 완료 (모든 데이터 있음)                │
│ 지문 2: ⚠️ 일부 누락                             │
│         - original ✅                            │
│         - translation ❌ (미생성)                │
│         - vocabulary ❌ (미생성)                 │
│ 지문 3: ❌ 미생성 (데이터 없음)                   │
├──────────────────────────────────────────────────┤
│ [누락 데이터 일괄 생성]  [완료된 것만 진행]       │
└──────────────────────────────────────────────────┘
```

### Task 11.3: 누락 데이터 생성 기능 (Phase 12에서 구현)
- [ ] 누락 슬롯 → 필요 데이터 유형 역매핑
- [ ] 해당 데이터 유형 프롬프트 자동 실행
- [ ] 생성 진행률 표시
- [ ] 생성 완료 후 재검증

### Task 11.4: 검증 API 구현 ✅
- [x] `/api/generation/validate` - 사전 검증
- [ ] `/api/generation/generate-missing` - 누락 데이터 생성 (Phase 12에서 구현)

---

## 🏗️ Phase 12: 출제 2단계 - 문제 생성/조합 시스템 🔶 UI완료/DB미적용

### Task 12.1: 슬롯 자동 매핑 로직 ✅
- [x] `lib/slot-mapper.ts` 생성
- [x] 저장된 슬롯 데이터 → 템플릿 슬롯 자동 매핑
- [x] 매핑 결과 검증

```typescript
// lib/slot-mapper.ts
export function mapDataToTemplate(
  slotData: Record<string, any>,
  template: QuestionTemplate
): MappedQuestion {
  const result: MappedQuestion = {}
  
  for (const slot of template.requiredSlots) {
    if (slotData[slot]) {
      result[slot] = slotData[slot]
    } else {
      throw new Error(`Missing required slot: ${slot}`)
    }
  }
  
  return result
}
```

### Task 12.2: 문제 조합 UI ✅
- [x] `components/features/generation/QuestionComposer.tsx`
- [x] 템플릿 미리보기
- [x] 슬롯별 데이터 표시
- [x] 출력 옵션 (마커, 배치, 정답/해설 포함)

### Task 12.3: 레이아웃 렌더링 ✅
- [x] 템플릿별 렌더러 구현 (`renderQuestionAsText`, `renderAnalysisAsText`)
- [x] 선택지 마커/레이아웃 옵션
- [ ] A4 레이아웃 (1단/2단) - Phase 8(PDF)에서 구현
- [ ] 페이지 나눔 처리 - Phase 8(PDF)에서 구현

### Task 12.4: 최종 출력 기능 ✅
- [x] 미리보기 모달
- [x] 저장 콜백 지원
- [ ] PDF 내보내기 연동 - Phase 8에서 구현

---

## 📊 출제 2단계 시스템 - DB 스키마 변경 요약

```sql
-- 1. data_types 테이블 확장
ALTER TABLE data_types 
  ADD COLUMN IF NOT EXISTS output_slots TEXT[] DEFAULT '{}';

-- 2. question_types 테이블 확장
ALTER TABLE question_types 
  ADD COLUMN IF NOT EXISTS required_slots TEXT[] DEFAULT '{}';

-- 3. generated_data 테이블 확장
ALTER TABLE generated_data 
  ADD COLUMN IF NOT EXISTS slot_data JSONB DEFAULT '{}';
```

---

## 🏗️ Phase 13: UI 통합 ✅ 완료 + 시스템 일원화

### Task 13.1: ~~출제2단계 탭 추가~~ → 문제출제 탭으로 일원화 ✅
- [x] ~~`MainContent.tsx`에 '출제2단계' ContentMode 추가~~ → 제거됨
- [x] 문제출제 탭에서 TwoStepGeneration 직접 렌더링

### Task 13.2: TwoStepGeneration 컴포넌트 ✅
- [x] `components/features/generation/TwoStepGeneration.tsx` 생성
- [x] 문제 유형 선택 드롭다운
- [x] 교재/단원/지문 트리 (체크박스 선택) - 자체 UI
- [x] 1단계 검증 / 2단계 조합 단계 전환
- [x] 교재 트리 로드 수정 (page.tsx와 동일한 방식)

### Task 13.3: page.tsx 통합 ✅
- [x] TwoStepGeneration import 및 렌더링
- [x] ~~'출제2단계' contentMode 처리~~ → '문제출제' contentMode로 통합

### Task 13.4: 버그 수정 ✅
- [x] 교재 트리 "교재 데이터가 없습니다" 문제 해결
- [x] 검증 API "문제 유형을 찾을 수 없습니다" 문제 해결
- [x] 검증 API "생성 데이터 조회 중 오류" 문제 해결

### Task 13.5: 시스템 일원화 ✅ (2024-12-06)
- [x] `OneClickGeneration.tsx` 삭제
- [x] `MainContent.tsx`에서 '출제2단계' 탭 제거
- [x] 문제출제 탭 → TwoStepGeneration으로 변경
- [x] 우측 패널 원큐 생성 UI 제거
- [x] 관련 import/export 정리

---

## 🔄 출제 2단계 시스템 흐름도

```
┌─────────────────────────────────────────────────────────────────┐
│                      관리자 설정 단계                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. 프롬프트 정의 (파싱 태그 포함)                               │
│     "[[original]]...[[/original]][[translation]]...[[/trans]]"  │
│                              ↓                                  │
│  2. 데이터 유형 정의 (출력 슬롯 지정)                            │
│     "문장분석" → output_slots: [original, translation, vocab]   │
│                              ↓                                  │
│  3. 문제 유형 정의 (필요 슬롯 지정)                              │
│     "문장분석_좌우배치" → required_slots: [original, translation]│
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                      출제 2단계 시스템                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1단계: 사전데이터 검증                                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 문제 유형 선택 → 필요 슬롯 확인 → 지문별 데이터 검증      │   │
│  │                              ↓                          │   │
│  │ 누락 있음? → [생성] → 프롬프트 실행 → 파싱 → 슬롯 저장    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  2단계: 문제 생성/조합                                           │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 저장된 슬롯 데이터 + 템플릿 → 자동 매핑 → 레이아웃 조합   │   │
│  │                              ↓                          │   │
│  │ 미리보기 → 확인 → 저장/PDF 출력                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📌 Phase 10-12 진행 현황

| Phase | 상태 | 예상 소요 | 완료일 |
|-------|------|----------|--------|
| Phase 10: 슬롯 시스템 기반 구축 | 🔶 UI완료/DB미적용 | 2일 | 2024-12-06 |
| Phase 11: 1단계 검증 시스템 | 🔶 UI완료/DB미적용 | 2일 | 2024-12-06 |
| Phase 12: 2단계 생성/조합 | 🔶 UI완료/DB미적용 | 3일 | 2024-12-06 |

### 🔶 현재 상태 설명

**구현 완료:**
- ✅ 슬롯 시스템 TypeScript 코드 (`slot-system.ts`, `prompt-parser.ts`, `slot-mapper.ts`)
- ✅ 데이터 검증 로직 (`data-validator.ts`)
- ✅ 출제2단계 UI 컴포넌트 (`TwoStepGeneration.tsx`, `DataValidation.tsx`, `QuestionComposer.tsx`)
- ✅ 검증 API (`/api/generation/validate`) - 간소화 버전
- ✅ 교재 트리 로드 (TwoStepGeneration에서 page.tsx와 동일한 방식 사용)

**미적용 (DB 마이그레이션 필요):**
- ⏳ `data_types.output_slots` 컬럼 추가
- ⏳ `question_types.required_slots` 컬럼 추가
- ⏳ `question_types.question_group` 컬럼 추가
- ⏳ `generated_data.slot_data` 컬럼 추가
- ⏳ 누락 데이터 자동 생성 API (`/api/generation/generate-missing`)

**API 간소화 상태:**
현재 검증 API는 DB 스키마 확장 없이 동작하도록 간소화됨:
- `required_slots` → `SLOT_GROUPS.practical` 기본값 사용
- `output_slots` → 미사용 (result만 저장)
- `slot_data` → 미사용 (데이터유형명을 키로 사용)

---

## 🎯 다음 단계 작업

### 우선순위 1: DB 마이그레이션 실행
```sql
-- supabase/migrations/20241206_slot_system.sql 실행
ALTER TABLE data_types ADD COLUMN IF NOT EXISTS output_slots TEXT[] DEFAULT '{}';
ALTER TABLE question_types ADD COLUMN IF NOT EXISTS required_slots TEXT[] DEFAULT '{}';
ALTER TABLE question_types ADD COLUMN IF NOT EXISTS question_group TEXT;
ALTER TABLE generated_data ADD COLUMN IF NOT EXISTS slot_data JSONB DEFAULT '{}';
```

### 우선순위 2: 누락 데이터 자동 생성 API 구현
- `/api/generation/generate-missing` 엔드포인트 완성
- 누락 슬롯 → 필요 데이터 유형 역매핑
- 프롬프트 자동 실행 및 결과 저장

### 우선순위 3: 검증 API 정상화
- DB 마이그레이션 완료 후 API를 원래 설계대로 복원
- `required_slots`, `output_slots`, `slot_data` 컬럼 활용

### 우선순위 4: Phase 8 (PDF 출력)
- A4 레이아웃 구현
- 페이지 나눔 처리
- PDF 생성 및 다운로드

---

## 🚀 MVP 1.0 완료 (2025-12-06)

### 두 가지 출제 경로 시스템

```
┌─────────────────────────────────────────────────────────────────┐
│                      문제 출제 시스템                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│    🚀 프롬프트 직접 생성              🧩 슬롯 기반 조합        │
│    ─────────────────────             ────────────────          │
│    • 설정 > 프롬프트에서 등록        • 설정 > 문제 유형에서 등록│
│    • "문제 유형으로 사용" 체크       • 사전데이터 검증 필요    │
│    • 즉시 문제 생성 가능             • 2단계 프로세스          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 구현 완료 항목

| # | 기능 | 파일 | 상태 |
|---|------|------|:----:|
| 1 | 프롬프트 직접 생성 API | `/api/generate-question/route.ts` | ✅ |
| 2 | prompts.is_question_type 컬럼 | DB 마이그레이션 | ✅ |
| 3 | question_types.prompt_id 연결 | DB 마이그레이션 | ✅ |
| 4 | 프롬프트 저장 시 문제 유형 자동 생성 | `/api/prompts/route.ts` | ✅ |
| 5 | 출제 UI 분기 (🚀/🧩) | `TwoStepGeneration.tsx` | ✅ |
| 6 | 출력 포맷 자동 주입 | `slot-system.ts` | ✅ |

### 문제 미리보기 시스템 (원소스)

```
src/components/features/question/
├── index.ts                    # Export 모음
├── QuestionRenderer.tsx        # 원소스 렌더러 (모든 문제 표시)
└── QuestionPreviewModal.tsx    # 공통 미리보기 모달
```

| 적용 위치 | 컴포넌트 | 상태 |
|-----------|----------|:----:|
| 문제 관리 상세 패널 | StatusDashboard | ✅ |
| 조합 미리보기 | QuestionComposer | ✅ |
| 최종 출력 페이지 | (추후 확장) | ⏳ |

### 미리보기 기능

- **출력 모드**: 미리보기 / 학생용 / 정답지
- **레이아웃 설정**: 마커(①/1./A./(1)) × 배치(세로/가로/2열)
- **표시 옵션**: 정답/해설 토글
- **액션**: 복사 / 인쇄

### DB 마이그레이션 (Supabase에서 실행 완료)

```sql
-- prompts 테이블
ALTER TABLE prompts ADD COLUMN IF NOT EXISTS is_question_type BOOLEAN DEFAULT FALSE;
ALTER TABLE prompts ADD COLUMN IF NOT EXISTS question_group TEXT DEFAULT 'practical';

-- question_types 테이블
ALTER TABLE question_types ADD COLUMN IF NOT EXISTS prompt_id UUID REFERENCES prompts(id) ON DELETE SET NULL;
```

---

## 👨‍🏫 강사 페이지 (2025-12-06)

### 라우트
- `/teacher` - 강사 전용 문제 조회 및 출력 페이지

### 레이아웃 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                      강사 페이지                                 │
├─────────────────────────────────────────────────────────────────┤
│  [좌측 트리]     │     [중앙 콘텐츠]     │    [우측 패널]       │
│  ────────────    │    ─────────────      │    ───────────       │
│  📚 교재 목록    │    📄 문제 카드       │    👁 미리보기       │
│    (읽기 전용)   │    • 유형별 필터      │    • 상세 보기       │
│                  │    • 날짜 표시        │    • 인쇄 버튼       │
│  ↓ 관리자와 동일 │                       │    • PDF 다운로드    │
│                  │                       │                      │
└─────────────────────────────────────────────────────────────────┘
```

### 구현 완료 항목

| # | 기능 | 상태 |
|---|------|:----:|
| 1 | 읽기 전용 트리 컴포넌트 | ✅ |
| 2 | 지문별 문제 조회 API 연동 | ✅ |
| 3 | 문제 카드 목록 UI | ✅ |
| 4 | 문제 미리보기 패널 | ✅ |
| 5 | 인쇄/PDF 버튼 (UI만) | ✅ |

### 파일 구조

```
src/app/teacher/
└── page.tsx                # 강사 페이지 메인
```

### 관리자 vs 강사 비교

| 기능 | 관리자 | 강사 |
|------|:------:|:----:|
| 트리 구조 | ✅ 편집 가능 | 📖 읽기 전용 |
| 문제 생성 | ✅ 가능 | ❌ 불가 |
| 문제 조회 | ✅ | ✅ |
| 문제 삭제 | ✅ | ❌ |
| 미리보기 | ✅ | ✅ |
| 출력/다운로드 | ⏳ | ✅ (핵심 기능) |
